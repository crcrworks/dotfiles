# cavaのインストール修正プラン

## 問題の根本原因

cavaのGitHubリポジトリ（karlstav/cava）は**ソースコードのみ**を配布しており、macOS ARM64向けのプリコンパイル済みバイナリは提供していません。

- ダウンロードされたファイル：`cava-0.10.7.tar.gz`（ソースコードのtarball）
- インストール結果：`configure`、`Makefile`などのソースファイルがあるが、実行可能な`cava`バイナリがない
- 結果：コマンドが使えない

## 解決策（優先順）

### 1. MacPortsを使用（推奨）

MacPortsはcavaを提供しており、Apple Silicon向けのアーカイブ（プリコンパイル済みバイナリ）があります。

**手順**:
1. MacPortsがインストールされていることを確認
2. MacPortsでcavaをインストール：
   ```bash
   sudo port install cava
   ```

**利点**:
- Homebrewを使用しない
- プリコンパイル済みバイナリ（コンパイル不要）
- 依存関係をMacPortsが管理

**欠点**:
- MacPortsのインストールが必要（まだインストールされていない場合）
- Homebrewと同様のシステムレベルのパッケージマネージャー

### 2. ソースから手動ビルド

miseの設定を削除し、手動でビルドしてインストールします。

**手順**:
1. mise設定から`github:karlstav/cava`を削除
2. 依存関係をインストール（Xcode Command Line Toolsが必要）：
   ```bash
   xcode-select --install
   ```
3. ソースからビルド：
   ```bash
   cd /tmp
   curl -LO https://github.com/karlstav/cava/releases/download/0.10.7/cava-0.10.7.tar.gz
   tar xzf cava-0.10.7.tar.gz
   cd cava-0.10.7
   ./autogen.sh
   ./configure
   make
   sudo make install
   ```

**利点**:
- パッケージマネージャー不要
- 最新バージョンを使用可能

**欠点**:
- 手動ビルドと依存関係の管理が必要
- システム全体にインストールされる（miseのバージョン管理外）

### 3. miseタスクでビルドを自動化

miseのタスク機能を使用して、cavaのビルドを自動化します。

**手順**:
1. `~/.config/mise/config.toml`にタスクを追加：
   ```toml
   [tasks.install-cava]
   run = '''
     set -e
     tmp_dir=$(mktemp -d)
     cd "$tmp_dir"
     curl -LO https://github.com/karlstav/cava/releases/download/0.10.7/cava-0.10.7.tar.gz
     tar xzf cava-0.10.7.tar.gz
     cd cava-0.10.7
     ./autogen.sh
     ./configure --prefix="$MISE_DATA_DIR/installs/cava/0.10.7"
     make
     make install
     rm -rf "$tmp_dir"
   '''
   ```

2. 実行：
   ```bash
   mise run install-cava
   ```

**利点**:
- miseの枠組み内で完結
- ビルドプロセスを再現可能

**欠点**:
- 初回は手動ビルドが必要
- 複雑な設定

## 修正ファイル

- `~/.config/mise/config.toml`（37-41行目を削除、必要に応じてタスクを追加）

## 検証

どの解決策を選んでも、まず既存の部分的なインストールを削除：
```bash
rm -rf ~/.local/share/mise/installs/github-karlstav-cava
```

その後、選択した方法でインストールし、以下で確認：
```bash
cava --version
```
