# OpenCode Configuration Migration: mode → agent

## Summary

Migrate deprecated `mode` configuration to the recommended `agent` configuration in `opencode.json`.

## Current State

The config uses the deprecated `mode` option:
- `mode.plan.prompt` - Custom prompt for plan mode
- `mode.ask.tools` - Tool restrictions for ask mode

## Migration Strategy

### 1. Create agent.plan configuration

Move `mode.plan.prompt` → `agent.plan.prompt`:
```json
{
  "agent": {
    "plan": {
      "prompt": "懸念点、トレードオフなど、文字通り何でも詳細に私にインタビューしてください。ただし、質問は明らかなものではないことを確認してください非常に詳細に掘り下げて、完了するまで継続的にインタビューを続けてください。"
    }
  }
}
```

### 2. Create agent.ask configuration

Move `mode.ask.tools` → `agent.ask.tools`:
```json
{
  "agent": {
    "ask": {
      "tools": {
        "write": false,
        "edit": false,
        "bash": false,
        "patch": false,
        "todowrite": false,
        "read": true,
        "grep": true,
        "glob": true,
        "list": true,
        "todoread": true,
        "webfetch": true
      }
    }
  }
}
```

### 3. Remove deprecated mode section

Delete the entire `mode` key from the config.

## Files to Modify

**Path:** `/Users/crcr/.local/share/chezmoi/dot_config/opencode/opencode.json`

## Verification

1. Start OpenCode: `opencode`
2. Verify no configuration errors appear
3. Test switching between agents (Tab key)
4. Verify plan agent uses the custom prompt
5. Verify ask agent has restricted tool access
6. Run `opencode config` to validate configuration

## Expected Result

- Configuration uses modern `agent` option
- No deprecated warnings in logs
- Plan agent behavior unchanged (custom prompt active)
- Ask agent behavior unchanged (tool restrictions active)
- Config cleaner and future-proof

## Implementation Steps

1. ✅ Read current `opencode.json`
2. ✅ Replace `"mode": {` with `"agent": {`
3. ✅ Update structure: `mode.plan.prompt` → `agent.plan.prompt`
4. ✅ Update structure: `mode.ask.tools` → `agent.ask.tools`
5. ✅ Ensure JSON is valid
6. ✅ Test configuration

## Verification Results

✅ Configuration uses modern `agent` option
✅ No deprecated warnings in logs
✅ Plan agent behavior preserved (custom prompt active)
✅ Ask agent behavior preserved (tool restrictions active)
✅ `opencode agent list` shows both `plan` and `ask` agents
✅ Config successfully loaded by OpenCode
